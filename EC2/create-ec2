# This script creates an EC2 instance that runs a simple Apache server

import boto3

# Step 1 Create an EC2 Resource

ec2_resource = boto3.resource('ec2', region_name= 'us-east-1')

# Step 2 Launch an EC2 Instance

zinstances = ec2_resource.create_instances(
    ImageId = '',      # Specify Image ID
    MinCount = 1,       # Setting the minimum instance launched
    MaxCount = 1,       # Setting the maximum instance launched
    InstanceType = 't2.micro',  # Specifying Instance Type
    KeyName = '',   # Specifying the Key Pair
    SecurityGroupIds = [""],        #  Add your actual SG ID here
    BlockDeviceMappings = [         # Adding extra EBS Volume
        {
            'DeviceName': '/dev/sdf',
            'Ebs': {
                'VolumeSize': 10,
                'VolumeType': 'gp2',
                'DeleteOnTermination': False
            }
        }
    ],
    TagSpecifications = [       # Specifying Tags to easily identify resources
        {
            'ResourceType': 'instance',
            'Tags': [
                {
                    'Key': 'Name',
                    'Value': 'boto3-EC2',
                },
                {
                    'Key': 'Env',
                    'Value': 'Test',
                }
            ]
        }
    ],

    # Adding a User data to launch a Apache website
    UserData = '''#!/bin/bash
    # Update the package list
    sudo yum update -y
    # Install Apache
    sudo yum install -y httpd
    # Start Service
    sudo systemctl start httpd
    # Enable service
    sudo systemctl enable httpd
    # Create an index file
    echo "<h1>Hello from Apache on Amazon Linux 2</h1>" > /var/www/html/index.html
    '''
)

print("My instance has been created successfully")
